# Dify + pgvector é–‹ç™ºç’°å¢ƒï¼ˆUdemy å—è¬›è€…å‘ã‘ï¼‰

ãƒ­ãƒ¼ã‚«ãƒ«ã§ Dify OSS ã¨ PostgreSQL(pgvector) + Redis ã‚’ã™ãã«èµ·å‹•ã§ãã‚‹æœ€å°æ§‹æˆã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ Dify ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ™ã‚¯ãƒˆãƒ«DBã«æ–‡æ›¸ã‚’å–ã‚Šè¾¼ã¿ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼AIã®è©¦ä½œãŒè¡Œãˆã¾ã™ã€‚

- ã‚¢ã‚¯ã‚»ã‚¹URL: http://localhost:8080
- Dify Web(å†…éƒ¨): http://localhost:3000
- Dify API(å†…éƒ¨): http://localhost:5001
- pgAdmin ç­‰ã¯å«ã¿ã¾ã›ã‚“ï¼ˆä»»æ„ï¼‰

## 1. å¿…è¦è¦ä»¶
- Docker 24+ / Docker Compose v2+
- CPU/RAM: 2C/4GB ä»¥ä¸ŠæŽ¨å¥¨
- ãƒãƒ¼ãƒˆä½¿ç”¨: 8080, 3000, 5001, 6379, 5432

## 2. ä½¿ã„æ–¹

1) .env ã®ä½œæˆ

```bash
cp .env.example .env
# å¿…è¦ã«å¿œã˜ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç­‰ã‚’ç·¨é›†
```

**é‡è¦**: `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã® `POSTGRES_PASSWORD` ã¨ `docker-compose.yml` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ä¸ä¸€è‡´ã®å ´åˆã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

2) èµ·å‹•

```bash
docker compose up -d
# åˆå›žã¯DBåˆæœŸåŒ–ã®ãŸã‚30-60ç§’ç¨‹åº¦ãŠå¾…ã¡ãã ã•ã„
```

3) ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåˆå›žã®ã¿å¿…é ˆï¼‰

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
docker compose exec dify-api flask db upgrade
```

4) ã‚¢ã‚¯ã‚»ã‚¹

- ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:8080 ã‚’é–‹ã
- **é‡è¦**: åˆå›žã¯ `/install` ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å®Œäº†
- ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€åå‰ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šï¼‰
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†å¾Œã€http://localhost:8080/apps ã§ãƒ¡ã‚¤ãƒ³ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä½œæˆâ†’æ–‡æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â†’ã‚¢ãƒ—ãƒªä½œæˆã®é †ã§ä½“é¨“å¯èƒ½

5) ãƒ­ã‚°ç¢ºèª/åœæ­¢

```bash
docker compose logs -f --tail=100
docker compose down -v   # ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚‚å‰Šé™¤ï¼ˆãƒ‡ãƒ¼ã‚¿æ¶ˆåŽ»ï¼‰
```

## 3. æ§‹æˆ

- reverse-proxy: Nginxã€‚`/console/api/*` ã‚’ `dify-api:5001` ã¸ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã€ãã®ä»–ã‚’ `dify-web:3000` ã¸ã€‚
- dify-web: Web UIã€‚èµ·å‹•æ™‚ã«é™çš„JSå†…ã® `127.0.0.1:5001` ãªã©ã‚’ `http://localhost:8080/console/api` ã«æ›¸ãæ›ãˆã¾ã™ï¼ˆentrypointï¼‰ã€‚
- dify-api: Dify APIã€‚
- dify-worker: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼ˆAPIã‚¤ãƒ¡ãƒ¼ã‚¸ã® MODE=workerï¼‰ã€‚
- redis: Celery ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼å…¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€‚
- db: PostgreSQL + pgvector æ‹¡å¼µï¼ˆ`pgvector/pgvector:pg16`ï¼‰ã€‚

## 4. ãƒ™ã‚¯ãƒˆãƒ«DBæˆ¦ç•¥ã®é¸æŠž

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€pgvectorã®é‹ç”¨æˆ¦ç•¥ã‚’é¸æŠžã—ã¦ãã ã•ã„ã€‚ç”¨é€”ãƒ»è¦æ¨¡ãƒ»ãƒãƒ¼ãƒ ä½“åˆ¶ã«å¿œã˜ã¦æœ€é©ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒç•°ãªã‚Šã¾ã™ã€‚

### é¸æŠžè‚¢

#### ã€é¸æŠžè‚¢ Aã€‘Dify + pgvector ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹æˆï¼ˆæŽ¨å¥¨ãƒ»æœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæŽ¡ç”¨ï¼‰

DifyãŒè‡ªå‹•ç®¡ç†ã™ã‚‹pgvectorã‚’ãã®ã¾ã¾ä½¿ç”¨ã€‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ—ãƒ»è·é›¢ãƒ¡ãƒˆãƒªãƒƒã‚¯ãƒ»æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã™ã¹ã¦Difyå´ã§åˆ¶å¾¡ã•ã‚Œã¾ã™ã€‚

**âœ… æŽ¨å¥¨ã‚·ãƒ¼ãƒ³:**
- ãƒ™ã‚¯ãƒˆãƒ«æ•°: ã€œ10ä¸‡ä»¶ç¨‹åº¦
- ç”¨é€”: å­¦ç¿’ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã€MVPã€å°ã€œä¸­è¦æ¨¡ã‚¢ãƒ—ãƒª
- ãƒãƒ¼ãƒ : å€‹äººã€œå°è¦æ¨¡ï¼ˆDBAä¸åœ¨ã§ã‚‚OKï¼‰
- é–‹ç™ºé€Ÿåº¦: æœ€é€Ÿã§å‹•ã‹ã—ãŸã„
- ä¿å®ˆ: ã‚·ãƒ³ãƒ—ãƒ«ã•ãƒ»ä¿å®ˆæ€§ã‚’é‡è¦–

**ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… è¨­å®šä¸è¦ã€ã™ãã«ä½¿ãˆã‚‹ï¼ˆ5ã€œ10åˆ†ã§èµ·å‹•ï¼‰
- âœ… Difyã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«è‡ªå‹•è¿½å¾“
- âœ… ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒé©ç”¨ã•ã‚Œã‚‹
- âœ… ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå®¹æ˜“
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚µãƒãƒ¼ãƒˆè±Šå¯Œ

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- âŒ æ¤œç´¢é€Ÿåº¦ã®æœ€é©åŒ–ä½™åœ°ãŒé™å®šçš„
- âŒ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ—ã‚’é¸ã¹ãªã„ï¼ˆDifyã®åˆ¤æ–­ã«ä¾å­˜ï¼‰
- âŒ å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆ10ä¸‡ä»¶è¶…ï¼‰ã§ã¯é€Ÿåº¦ä½Žä¸‹ã®å¯èƒ½æ€§
- âŒ è©³ç´°ãªãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãŒã§ããªã„

**å®Ÿè£…é›£æ˜“åº¦:** â­â˜†â˜†â˜†â˜†ï¼ˆåˆå¿ƒè€…OKï¼‰

---

#### ã€é¸æŠžè‚¢ Bã€‘pgvector ç‹¬è‡ªæœ€é©åŒ– + Difyé€£æº

pgvectorã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆHNSW/IVFFLATï¼‰ã‚’ç‹¬è‡ªã«æ§‹ç¯‰ãƒ»æœ€é©åŒ–ã—ã€Difyã‹ã‚‰ã¯ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã•ã‚ŒãŸDBã‚’å‚ç…§ã™ã‚‹æ§‹æˆã€‚

**âœ… æŽ¨å¥¨ã‚·ãƒ¼ãƒ³:**
- ãƒ™ã‚¯ãƒˆãƒ«æ•°: 10ä¸‡ä»¶ä»¥ä¸Š
- ç”¨é€”: æœ¬ç•ªç’°å¢ƒã€åŽç›ŠåŒ–ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã€å¤§è¦æ¨¡ã‚µãƒ¼ãƒ“ã‚¹
- ãƒãƒ¼ãƒ : DBAãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒã„ã‚‹
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹: ãƒ¬ã‚¹ãƒãƒ³ã‚¹100msä»¥ä¸‹ãªã©åŽ³æ ¼ãªè¦ä»¶
- åŒæ™‚æŽ¥ç¶š: æ•°ç™¾ã€œæ•°åƒãƒ¦ãƒ¼ã‚¶ãƒ¼

**ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… æ¤œç´¢é€Ÿåº¦ã‚’æœ€å¤§é™ã«æœ€é©åŒ–å¯èƒ½
- âœ… ãƒ‡ãƒ¼ã‚¿ç‰¹æ€§ã«å¿œã˜ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é¸æŠžï¼ˆHNSW/IVFFLATï¼‰
- âœ… ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã§ç²¾åº¦ãƒ»é€Ÿåº¦ã‚’èª¿æ•´
- âœ… ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- âŒ åˆæœŸè¨­å®šã«å°‚é–€çŸ¥è­˜ãŒå¿…è¦ï¼ˆpgvectorã€SQLãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼‰
- âŒ Difyã®ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ç«¶åˆã™ã‚‹ãƒªã‚¹ã‚¯
- âŒ Difyã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ™‚ã«è¨­å®šã®å†ç¢ºèªãŒå¿…è¦
- âŒ ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã®åˆ‡ã‚Šåˆ†ã‘ãŒè¤‡é›‘
- âŒ ä¿å®ˆã‚³ã‚¹ãƒˆå¢—ï¼ˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã€å†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç­‰ï¼‰

**å®Ÿè£…é›£æ˜“åº¦:** â­â­â­â­â˜†ï¼ˆä¸Šç´šè€…å‘ã‘ï¼‰

---

### åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```
é–‹å§‹
 â”‚
 â”œâ”€ ãƒ™ã‚¯ãƒˆãƒ«æ•°ã¯10ä¸‡ä»¶ä»¥ä¸‹ï¼Ÿ
 â”‚   â”œâ”€ YES â†’ ã€é¸æŠžè‚¢ Aã€‘Difyãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæŽ¨å¥¨ï¼‰
 â”‚   â””â”€ NO  â†’ æ¬¡ã¸
 â”‚
 â”œâ”€ DBAãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒã„ã‚‹ï¼Ÿ
 â”‚   â”œâ”€ NO  â†’ ã€é¸æŠžè‚¢ Aã€‘Difyãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæŽ¨å¥¨ï¼‰
 â”‚   â””â”€ YES â†’ æ¬¡ã¸
 â”‚
 â”œâ”€ ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦ã«åŽ³æ ¼ãªè¦ä»¶ãŒã‚ã‚‹ï¼Ÿï¼ˆ100msä»¥ä¸‹ãªã©ï¼‰
 â”‚   â”œâ”€ NO  â†’ ã€é¸æŠžè‚¢ Aã€‘Difyãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæŽ¨å¥¨ï¼‰
 â”‚   â””â”€ YES â†’ ã€é¸æŠžè‚¢ Bã€‘ç‹¬è‡ªæœ€é©åŒ–ã‚’æ¤œè¨Ž
 â”‚
 â””â”€ æœ¬ç•ªç’°å¢ƒã§åŽç›ŠåŒ–ã—ã¦ã„ã‚‹ï¼Ÿ
     â”œâ”€ NO  â†’ ã€é¸æŠžè‚¢ Aã€‘Difyãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæŽ¨å¥¨ï¼‰
     â””â”€ YES â†’ ã€é¸æŠžè‚¢ Bã€‘ç‹¬è‡ªæœ€é©åŒ–ã‚’æ¤œè¨Ž
```

---

### æ¯”è¼ƒè¡¨

| é …ç›® | é¸æŠžè‚¢ A: Difyãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | é¸æŠžè‚¢ B: ç‹¬è‡ªæœ€é©åŒ– |
|------|------------------------|-------------------|
| **åˆæœŸæ§‹ç¯‰æ™‚é–“** | 5ã€œ10åˆ† | 2ã€œ5æ—¥ |
| **æ¤œç´¢é€Ÿåº¦ï¼ˆå°è¦æ¨¡ï¼‰** | ååˆ†é«˜é€Ÿ | ã‚„ã‚„é«˜é€Ÿ |
| **æ¤œç´¢é€Ÿåº¦ï¼ˆå¤§è¦æ¨¡ï¼‰** | ä½Žä¸‹ã™ã‚‹å¯èƒ½æ€§ | æœ€é©åŒ–å¯èƒ½ |
| **ç²¾åº¦èª¿æ•´** | Difyè¨­å®šã®ã¿ | è©³ç´°ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°å¯ |
| **ä¿å®ˆã‚³ã‚¹ãƒˆ** | ä½Žã„ | é«˜ã„ |
| **Difyæ›´æ–°è¿½å¾“æ€§** | è‡ªå‹• | æ‰‹å‹•ç¢ºèªå¿…è¦ |
| **ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œ** | å®¹æ˜“ | è¤‡é›‘ |
| **å¿…è¦ã‚¹ã‚­ãƒ«** | DockeråŸºç¤Ž | PostgreSQLã€pgvector |
| **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** | è±Šå¯Œ | å°‘ãªã„ |
| **æŽ¨å¥¨ãƒ‡ãƒ¼ã‚¿è¦æ¨¡** | ã€œ10ä¸‡ä»¶ | 10ä¸‡ä»¶ã€œ |

---

### æœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æŽ¡ç”¨æˆ¦ç•¥

**ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ã€é¸æŠžè‚¢ Aã€‘ã‚’æŽ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚**

ç†ç”±:
- å¯¾è±¡: Udemyå—è¬›è€…ï¼ˆå­¦ç¿’ãƒ»ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ä½œæˆï¼‰
- ç›®çš„: æœ€çŸ­æ™‚é–“ã§ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼AIä½“é¨“
- è¦æ¨¡: å°ã€œä¸­è¦æ¨¡æƒ³å®š
- ä¿å®ˆæ€§: ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’æœ€å„ªå…ˆ

**é¸æŠžè‚¢ Bã‚’å¸Œæœ›ã™ã‚‹å ´åˆ:**

æœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ãã®ã¾ã¾ã§ã¯å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚ä»¥ä¸‹ã®æ‰‹é †ã§ç‹¬è‡ªã«å®Ÿè£…ã—ã¦ãã ã•ã„:

1. `db/init.sql` ã‚’ä½œæˆã—ã¦HNSW/IVFFLATã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å®šç¾©
2. `docker-compose.yml` ã® `db` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒžã‚¦ãƒ³ãƒˆ
3. Difyã®ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«æ‰‹å‹•ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†æ§‹ç¯‰
4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

å‚è€ƒãƒªã‚½ãƒ¼ã‚¹:
- pgvectorå…¬å¼: https://github.com/pgvector/pgvector
- HNSW vs IVFFLAT: https://github.com/pgvector/pgvector#indexing

**é‡è¦:** ç‹¬è‡ªæœ€é©åŒ–ã¯Difyå…¬å¼ã‚µãƒãƒ¼ãƒˆç¯„å›²å¤–ã§ã™ã€‚ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã¯è‡ªå·±è§£æ±ºãŒå¿…è¦ã§ã™ã€‚

---

### ã‚ˆãã‚ã‚‹è³ªå•

**Q1: å¾Œã‹ã‚‰é¸æŠžè‚¢Aã‹ã‚‰é¸æŠžè‚¢Bã«ç§»è¡Œã§ãã‚‹ï¼Ÿ**

A: å¯èƒ½ã§ã™ãŒã€ä»¥ä¸‹ã®ä½œæ¥­ãŒå¿…è¦ã§ã™:
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å†æ§‹ç¯‰ï¼ˆæ•°æ™‚é–“ã€œæ•°æ—¥ï¼‰
- Difyã¨ã®äº’æ›æ€§ç¢ºèª
- å‹•ä½œæ¤œè¨¼

ãƒ‡ãƒ¼ã‚¿é‡ãŒå¢—ãˆã¦ã‹ã‚‰ç§»è¡Œã™ã‚‹ã‚ˆã‚Šã€æœ€åˆã‹ã‚‰é¸æŠžè‚¢Bã§å§‹ã‚ã‚‹æ–¹ãŒåŠ¹çŽ‡çš„ã§ã™ã€‚

**Q2: é¸æŠžè‚¢Aã§ã‚‚ååˆ†ãªé€Ÿåº¦ãŒå‡ºã‚‹ï¼Ÿ**

A: ä»¥ä¸‹ã®æ¡ä»¶ã§ã‚ã‚Œã°ååˆ†ã§ã™:
- ãƒ™ã‚¯ãƒˆãƒ«æ•°: ã€œ10ä¸‡ä»¶
- åŒæ™‚æŽ¥ç¶š: ã€œ100ãƒ¦ãƒ¼ã‚¶ãƒ¼
- æ¤œç´¢ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 500msã€œ1ç§’ç¨‹åº¦ã§è¨±å®¹

ãã‚Œä»¥ä¸Šã®è¦æ¨¡ãƒ»é€Ÿåº¦ãŒå¿…è¦ãªå ´åˆã¯é¸æŠžè‚¢Bã‚’æ¤œè¨Žã—ã¦ãã ã•ã„ã€‚

**Q3: é¸æŠžè‚¢Aã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å•é¡ŒãŒå‡ºãŸã‚‰ã©ã†ã™ã‚‹ï¼Ÿ**

æ®µéšŽçš„ãªå¯¾å¿œ:
1. PostgreSQL/Redisã®ãƒªã‚½ãƒ¼ã‚¹å¢—å¼·ï¼ˆãƒ¡ãƒ¢ãƒªã€CPUï¼‰
2. Difyå´ã®æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ï¼ˆå–å¾—ä»¶æ•°ã€ã‚¹ã‚³ã‚¢é–¾å€¤ï¼‰
3. ãã‚Œã§ã‚‚ä¸è¶³ãªã‚‰é¸æŠžè‚¢Bã¸ã®ç§»è¡Œã‚’æ¤œè¨Ž

---

## 3.5 æœ€çŸ­ãƒ«ãƒ¼ãƒˆï¼ˆ20ã€œ30åˆ†ã§ã‚­ãƒ£ãƒ©AIï¼‰

æ‰€è¦ç›®å®‰: ç”»åƒã®åˆå›žpull 5ã€œ10åˆ† + åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— 3ã€œ5åˆ† + ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼†ã‚¢ãƒ—ãƒªä½œæˆ 10ã€œ15åˆ†ã€‚

1) ãƒªãƒã‚¸ãƒˆãƒªå–å¾—ã¨èµ·å‹•

```bash
git clone https://github.com/togashira/dify_vectordb_autoprograming.git
cd dify_vectordb_autoprograming
cp .env.example .env
docker compose up -d
docker compose logs -f --tail=100   # åˆå›žã¯30ã€œ60ç§’ã»ã©å¾…æ©Ÿ
```

2) ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåˆå›žã®ã¿å¿…é ˆï¼‰

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
docker compose exec dify-api flask db upgrade
```

3) ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹
- http://localhost:8080/install ã‚’é–‹ãï¼ˆ**é‡è¦**: `/install` ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
- åˆå›žã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ç®¡ç†è€…ã‚’ä½œæˆ
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†å¾Œã€http://localhost:8080/apps ã§ãƒ¡ã‚¤ãƒ³ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹

4) ãƒ¢ãƒ‡ãƒ«/åŸ‹ã‚è¾¼ã¿è¨­å®šï¼ˆDifyã®ç”»é¢å†…ï¼‰
- Settings â†’ Model Providers ã§ OpenAI ãªã©ã‚’æœ‰åŠ¹åŒ–ï¼ˆAPI Key å¿…è¦ï¼‰
- Embedding ã‚’1ã¤æœ‰åŠ¹åŒ–ï¼ˆä¾‹: text-embedding-3-smallï¼‰

5) ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä½œæˆ
- Datasets â†’ New â†’ PDF/ãƒ†ã‚­ã‚¹ãƒˆã‚’1ã¤ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–å®Œäº†ã¾ã§å¾…ã¤

6) ã‚¢ãƒ—ãƒªï¼ˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼AIï¼‰ä½œæˆ
- Apps â†’ Create App â†’ Chatflowï¼ˆã¾ãŸã¯ Chatbotï¼‰
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ Knowledge ãƒŽãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æŽ¥ç¶š
- System Prompt ã«ã‚­ãƒ£ãƒ©è¨­å®šï¼ˆå£èª¿/æ€§æ ¼/ç¦æ­¢äº‹é …ãªã©ï¼‰ã‚’è¨˜è¿°
- Preview ã§ä¼šè©±ãƒ†ã‚¹ãƒˆ â†’ Publish

ã“ã‚Œã§ãƒ­ãƒ¼ã‚«ãƒ«ã§ã€Œæœ€åˆã®å¿œç­”ã€ã¾ã§åˆ°é”ã—ã¾ã™ã€‚

## 5. ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«

### 5.1 åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–¢é€£
- **ç®¡ç†ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œãªã„**: `http://localhost:8080/install` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å®Œäº†ã—ã¦ãã ã•ã„
- **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‹ã‚‰é€²ã¾ãªã„**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœªå®Ÿè¡Œã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`docker compose exec dify-api flask db upgrade` ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
- **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—APIã‚¨ãƒ©ãƒ¼**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆ`.env` ã¨ `docker-compose.yml` ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸€è‡´ï¼‰

### 5.2 æŽ¥ç¶šãƒ»èµ·å‹•é–¢é€£
- **8080 ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ 502/504**: èµ·å‹•ç›´å¾Œã¯ API ãŒåˆæœŸåŒ–ä¸­ã®å¯èƒ½æ€§ã€‚30-60ç§’å¾…ã£ã¦ãƒªãƒ­ãƒ¼ãƒ‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šã‚¨ãƒ©ãƒ¼**: `.env` ã® `POSTGRES_PASSWORD` ã¨ `docker-compose.yml` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- **ãƒãƒ¼ãƒˆè¡çª**: `docker compose ps` ã§ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèªã—ã€.env ã®ãƒãƒ¼ãƒˆã‚’å¤‰æ›´
- **DockerãŒé‡ã„/é…ã„**: Docker Desktop â†’ Resources ã§ãƒ¡ãƒ¢ãƒª4ã€œ6GBã«å¢—ã‚„ã™ã¨å®‰å®šã—ã‚„ã™ã„ï¼ˆMacã®å ´åˆï¼‰

### 5.3 ãƒ–ãƒ©ã‚¦ã‚¶é–¢é€£
- **ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µMetaMaskç­‰ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼**: ä»–ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ‹¡å¼µã¨ç«¶åˆã™ã‚‹å ´åˆã‚ã‚Šã€‚åˆ¥ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«/ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§å›žé¿å¯
- **APIæŽ¥ç¶šã‚¨ãƒ©ãƒ¼**: ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã‚’ç¢ºèªã—ã€APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã—ãå‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### 5.4 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ‰‹é †
```bash
# 1. ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
docker compose ps

# 2. ãƒ­ã‚°ç¢ºèª
docker compose logs dify-api --tail=20
docker compose logs dify-web --tail=20

# 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šç¢ºèª
docker compose exec dify-api python -c "import psycopg2; conn = psycopg2.connect('postgresql://dify:changeme@db:5432/dify'); print('Connection successful')"

# 4. APIå‹•ä½œç¢ºèª
curl -s http://localhost:8080/console/api/setup

# 5. å†èµ·å‹•
docker compose restart
```

## 6. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

æ§‹ç¯‰æ™‚ã«å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ðŸ“š ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

#### macOSç’°å¢ƒã®å ´åˆ
- **[macOSç’°å¢ƒã§ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](docs/MACOS_TROUBLESHOOTING.md)**
  - plugin-daemonèµ·å‹•ã‚¨ãƒ©ãƒ¼ï¼ˆæœ€é »å‡ºï¼‰
  - M1/M2 Macã§ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¨ãƒ©ãƒ¼
  - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šã‚¨ãƒ©ãƒ¼
  - ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
  - ãƒãƒ¼ãƒˆç«¶åˆ
  - RedisæŽ¥ç¶šã‚¨ãƒ©ãƒ¼
  - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—
  - å®Œå…¨ãƒªã‚»ãƒƒãƒˆæ‰‹é †

#### æ§‹ç¯‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- **[æ§‹ç¯‰æ‰‹é †ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ](docs/SETUP_CHECKLIST.md)**
  - Phase 1: äº‹å‰æº–å‚™ï¼ˆç’°å¢ƒç¢ºèªã€ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³ï¼‰
  - Phase 2: åˆå›žèµ·å‹•ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã€ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
  - Phase 3: å‹•ä½œç¢ºèªï¼ˆWebã‚¢ã‚¯ã‚»ã‚¹ã€APIç¢ºèªã€åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼‰
  - Phase 4: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆãƒ­ã‚°ç¢ºèªã€ãƒªã‚½ãƒ¼ã‚¹ç¢ºèªï¼‰
  - Phase 5: æœ¬ç•ªé‹ç”¨æº–å‚™

### ã‚ˆãã‚ã‚‹å•é¡Œã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¬ã‚¤ãƒ‰

```bash
# å•é¡Œ1: plugin-daemon ã‚¨ãƒ©ãƒ¼
# â†’ .envã§pluginæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ï¼ˆæ—¢ã«è¨­å®šæ¸ˆã¿ï¼‰
grep "PLUGIN_ENABLED=false" .env

# å•é¡Œ2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šã‚¨ãƒ©ãƒ¼
# â†’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèªã¨DBå†èµ·å‹•
docker compose down -v
docker compose up -d
docker compose exec dify-api flask db upgrade

# å•é¡Œ3: ãƒãƒ¼ãƒˆ8080ç«¶åˆ
# â†’ ä½¿ç”¨ä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
lsof -i :8080

# å•é¡Œ4: ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
# â†’ ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†å®Ÿè¡Œ
docker compose exec dify-api flask db upgrade

# å•é¡Œ5: å…¨ä½“çš„ãªä¸å…·åˆ
# â†’ ãƒ­ã‚°ç¢ºèª
docker compose logs -f --tail=100
```

è©³ç´°ã¯ä¸Šè¨˜ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## 12. ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ‡ãƒ¼ã‚¿æ¶ˆåŽ»ï¼‰

```bash
docker compose down -v
```

## 12. é‡è¦ãªãƒŠãƒ¬ãƒƒã‚¸ãƒ»ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 8.1 ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆæœ€é‡è¦ï¼‰

#### âœ… æŽ¨å¥¨: å®‰å®šç‰ˆã‚’å›ºå®š
```yaml
# docker-compose.yml
dify-web:
  image: docker.io/langgenius/dify-web:0.11.1  # å›ºå®šãƒãƒ¼ã‚¸ãƒ§ãƒ³
dify-api:
  image: docker.io/langgenius/dify-api:0.11.1
dify-worker:
  image: docker.io/langgenius/dify-api:0.11.1
```

#### âŒ æœ¬ç•ªç’°å¢ƒã§é¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³
```yaml
dify-web:
  image: docker.io/langgenius/dify-web:latest  # äºˆæœŸã›ã¬æ›´æ–°ã§å‹•ã‹ãªããªã‚‹
```

**ç†ç”±:**
- `latest`ã¯æœ€æ–°ç‰ˆã«è‡ªå‹•æ›´æ–°ã•ã‚Œã€äºˆæœŸã›ã¬å¤‰æ›´ãŒå…¥ã‚‹
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆ0.12.xä»¥é™ï¼‰ãŒä¸å®‰å®šã§ã‚¨ãƒ©ãƒ¼ãŒå¤šç™º
- ç ´å£Šçš„å¤‰æ›´ãŒå…¥ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³é¸æŠžã‚¬ã‚¤ãƒ‰:**
- âœ… **0.11.1**: å®‰å®šç‰ˆï¼ˆæŽ¨å¥¨ãƒ»ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä½¿ç”¨ï¼‰
- âœ… **0.10.x**: ã‚ˆã‚Šå®‰å®šã ãŒå¤ã„
- âš ï¸ **0.12.xä»¥é™**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½è¿½åŠ ã€ä¸å®‰å®š
- âŒ **latest**: æœ¬ç•ªç’°å¢ƒã§ã¯é¿ã‘ã‚‹

### 8.2 ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®ç„¡åŠ¹åŒ–

#### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã¨ã¯ï¼Ÿ
```
ã‚¨ãƒ©ãƒ¼ä¾‹:
Failed to request plugin daemon, url: plugin/[UUID]/management/models
Failed to request plugin daemon, url: plugin/[UUID]/management/install/tasks
```

ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ Dify 0.12.xä»¥é™ã§é »ç™ºã™ã‚‹å•é¡Œã§ã™ã€‚

#### æŽ¨å¥¨è¨­å®šï¼ˆ0.11.1 + ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç„¡åŠ¹åŒ–ï¼‰
```yaml
services:
  dify-web:
    image: docker.io/langgenius/dify-web:0.11.1  # å®‰å®šç‰ˆ

  dify-api:
    image: docker.io/langgenius/dify-api:0.11.1  # å®‰å®šç‰ˆ
    environment:
      - PLUGIN_ENABLED=false
      - DISABLE_PLUGIN_MANAGER=true

  dify-worker:
    image: docker.io/langgenius/dify-api:0.11.1  # å®‰å®šç‰ˆ
    environment:
      - PLUGIN_ENABLED=false
      - DISABLE_PLUGIN_MANAGER=true
```

**ç†ç”±:**
- âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒãªã„ãŸã‚å®‰å®š
- âœ… `plugin-daemon`ã‚µãƒ¼ãƒ“ã‚¹ä¸è¦
- âœ… ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„
- âœ… åŸºæœ¬æ©Ÿèƒ½ï¼ˆKnowledgeã€RAGã€Workflowç­‰ï¼‰ã¯ååˆ†ã«ä½¿ãˆã‚‹
- âœ… æœ¬ç•ªç’°å¢ƒã«é©ã—ã¦ã„ã‚‹

**0.12.xä»¥é™ï¼ˆlatestå«ã‚€ï¼‰ã®å•é¡Œç‚¹:**
- âŒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½è¿½åŠ ã«ã‚ˆã‚Šä¸å®‰å®š
- âŒ `plugin-daemon`ã‚µãƒ¼ãƒ“ã‚¹ãŒå¿…è¦ï¼ˆè¨­å®šãŒè¤‡é›‘ï¼‰
- âŒ å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸è¶³
- âŒ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒå¤§é‡ã«å‡ºã‚‹
- âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æƒ…å ±ãŒæ®‹ã‚Šã€ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå›°é›£

**ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã„ãŸã„å ´åˆï¼ˆéžæŽ¨å¥¨ï¼‰:**

```yaml
services:
  # æ—¢å­˜ã®ã‚µãƒ¼ãƒ“ã‚¹...

  plugin-daemon:
    image: docker.io/langgenius/dify-plugin-daemon:latest
    ports:
      - "5002:5002"
    environment:
      - PLUGIN_DAEMON_PORT=5002
      - PLUGIN_STORAGE_TYPE=local
      - PLUGIN_STORAGE_LOCAL_ROOT=/app/plugins
    volumes:
      - plugin-data:/app/plugins
    restart: always

  dify-api:
    image: docker.io/langgenius/dify-api:latest  # 0.12.xä»¥é™
    environment:
      - PLUGIN_ENABLED=true
      - PLUGIN_DAEMON_URL=http://plugin-daemon:5002

  dify-worker:
    image: docker.io/langgenius/dify-api:latest
    environment:
      - PLUGIN_ENABLED=true
      - PLUGIN_DAEMON_URL=http://plugin-daemon:5002

volumes:
  plugin-data: {}
```

**æ³¨æ„:**
- è¨­å®šãŒè¤‡é›‘ã§ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå¿…è¦
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸è¶³ã®ãŸã‚ã€è©¦è¡ŒéŒ¯èª¤ãŒå¿…è¦
- æœ¬ç•ªç’°å¢ƒã§ã¯æŽ¨å¥¨ã—ãªã„

### 8.3 Celery Workerè¨­å®šã®æ³¨æ„ç‚¹

#### å¿…é ˆè¨­å®šï¼ˆ0.11.1ã®æ—¢çŸ¥ãƒã‚°å¯¾å¿œï¼‰
```yaml
dify-worker:
  entrypoint: []  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆentrypointã‚’ç„¡åŠ¹åŒ–
  command: ["/bin/bash", "-c", "cd /app/api && celery -A app.celery worker -P gevent -c 1 --loglevel INFO -Q dataset,generation,mail,ops_trace"]
```

**ç†ç”±:**
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`entrypoint.sh`ã«Celeryã‚ªãƒ—ã‚·ãƒ§ãƒ³è§£æžã®ãƒã‚°ãŒã‚ã‚‹
- ã‚¨ãƒ©ãƒ¼: `Error: Invalid value for '-l' / '--loglevel': '-Q' is not one of...`
- Embeddingå‡¦ç†ãŒã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã§æ­¢ã¾ã‚‹åŽŸå› ã«ãªã‚‹

**é‡è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `-Q dataset,generation,mail,ops_trace`: å‡¦ç†ã™ã‚‹ã‚­ãƒ¥ãƒ¼ã‚’æ˜Žç¤ºçš„ã«æŒ‡å®š
- `-P gevent`: geventãƒ—ãƒ¼ãƒ«ã‚’ä½¿ç”¨ï¼ˆæŽ¨å¥¨ï¼‰
- `-c 1`: ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹æ•°ï¼ˆå¿…è¦ã«å¿œã˜ã¦èª¿æ•´ï¼‰

### 8.4 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šã®å¤šå±¤åŒ–

#### å¿…é ˆ: 3ç¨®é¡žã™ã¹ã¦è¨­å®š
```yaml
dify-api:
  environment:
    # ãƒ¬ã‚¤ãƒ¤ãƒ¼1: åŸºæœ¬çš„ãªDB URL
    - DATABASE_URL=postgresql://dify:changeme@db:5432/dify
    
    # ãƒ¬ã‚¤ãƒ¤ãƒ¼2: SQLAlchemyç”¨ï¼ˆå¤ã„ã‚³ãƒ¼ãƒ‰ï¼‰
    - SQLALCHEMY_DATABASE_URI=postgresql://dify:changeme@db:5432/dify
    
    # ãƒ¬ã‚¤ãƒ¤ãƒ¼3: å€‹åˆ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆæ–°ã—ã„ã‚³ãƒ¼ãƒ‰ï¼‰
    - DB_HOST=db
    - DB_PORT=5432
    - DB_USERNAME=dify
    - DB_PASSWORD=changeme
    - DB_DATABASE=dify
```

**ç†ç”±:**
- Difyã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„
- å¤ã„éƒ¨åˆ†ã¯`SQLALCHEMY_DATABASE_URI`ã‚’å‚ç…§
- æ–°ã—ã„éƒ¨åˆ†ã¯å€‹åˆ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(`DB_HOST`ç­‰)ã‚’å‚ç…§
- 1ã¤ã ã‘è¨­å®šã™ã‚‹ã¨ä¸€éƒ¨æ©Ÿèƒ½ãŒå‹•ã‹ãªã„

**ãƒˆãƒ©ãƒ–ãƒ«ä¾‹:**
- `DATABASE_URL`ã ã‘è¨­å®š â†’ æŽ¥ç¶šã‚¨ãƒ©ãƒ¼
- å€‹åˆ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã ã‘è¨­å®š â†’ ä¸€éƒ¨APIãŒ500ã‚¨ãƒ©ãƒ¼

### 8.5 Redisè¨­å®šã®æ˜Žç¤ºåŒ–

#### æŽ¨å¥¨è¨­å®š
```yaml
dify-api:
  environment:
    - REDIS_URL=redis://redis:6379/0
    - CELERY_BROKER_URL=redis://redis:6379/1  # åˆ¥DBç•ªå·
    - REDIS_HOST=redis
    - REDIS_PORT=6379
    - REDIS_DB=0
```

**ç†ç”±:**
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`localhost:6379`ã‚’å‚ç…§ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹
- Dockerç’°å¢ƒã§ã¯`redis`ãƒ›ã‚¹ãƒˆåãŒå¿…è¦
- Celeryã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§DBç•ªå·ã‚’åˆ†ã‘ã‚‹ã¨å®‰å…¨

**ãƒˆãƒ©ãƒ–ãƒ«ä¾‹:**
- Redisè¨­å®šãªã— â†’ ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„ï¼ˆ500ã‚¨ãƒ©ãƒ¼ï¼‰
- localhostå‚ç…§ â†’ ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡å¤±æ•—

### 8.6 ãƒ™ã‚¯ãƒˆãƒ«DBï¼ˆpgvectorï¼‰è¨­å®š

#### å¿…é ˆè¨­å®š
```yaml
dify-api:
  environment:
    - VECTOR_STORE=pgvector
    - PGVECTOR_HOST=db
    - PGVECTOR_PORT=5432
    - PGVECTOR_USER=dify
    - PGVECTOR_PASSWORD=changeme
    - PGVECTOR_DATABASE=dify
```

**ç†ç”±:**
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯`None`ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹: `Unsupported vector db type None`
- PostgreSQLã¨åŒã˜æŽ¥ç¶šæƒ…å ±ã‚’ä½¿ã†
- æ˜Žç¤ºçš„ã«`pgvector`ã‚’æŒ‡å®šã—ãªã„ã¨èªè­˜ã•ã‚Œãªã„

### 8.7 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸€è‡´ã®é‡è¦æ€§

#### ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ
```bash
# .env
POSTGRES_PASSWORD=changeme

# docker-compose.yml
environment:
  - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-changeme}  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚‚ä¸€è‡´ã•ã›ã‚‹
```

**ã‚ˆãã‚ã‚‹ãƒŸã‚¹:**
- `.env`ã«`changeme`ã€`docker-compose.yml`ã«`dify123` â†’ ä¸ä¸€è‡´ã§DBæŽ¥ç¶šã‚¨ãƒ©ãƒ¼
- `.env`ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„ã‚±ãƒ¼ã‚¹ â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä½¿ã‚ã‚Œã‚‹

**ç¢ºèªæ–¹æ³•:**
```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª
docker compose exec dify-api env | grep POSTGRES_PASSWORD
docker compose exec db env | grep POSTGRES_PASSWORD
```

### 8.8 åˆå›žãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆ

#### å¿…ãšå®Ÿè¡Œ
```bash
# ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•å¾Œã€åˆå›žã®ã¿å¿…é ˆ
docker compose exec dify-api flask db upgrade
```

**ç†ç”±:**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ãªã„ã¨500ã‚¨ãƒ©ãƒ¼
- `/install`ç”»é¢ãŒãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§æ­¢ã¾ã‚‹
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—APIãŒ`table does not exist`ã‚¨ãƒ©ãƒ¼

**æ‰€è¦æ™‚é–“ã®ç›®å®‰:**
```
åˆå›žãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: 30ç§’ã€œ1åˆ†
  - å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆç´„50å€‹ï¼‰
  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
  - åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥

ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ï¼ˆå¤‰æ›´ãªã—ï¼‰: 5ã€œ15ç§’
  - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã®ã¿

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—æ™‚: 15ç§’ã€œ2åˆ†
  - æ–°ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
  - ã‚«ãƒ©ãƒ è¿½åŠ /å¤‰æ›´
  - ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ

â€»ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ç›´å¾Œã¯é…ã„ï¼ˆPythonãƒ­ãƒ¼ãƒ‰æ™‚é–“å«ã‚€ï¼‰
â€»ã€ŒINFO [alembic.runtime.migration] Will assume transactional DDL.ã€ãŒå‡ºã‚Œã°æ­£å¸¸å‹•ä½œä¸­
```

**ç¢ºèªæ–¹æ³•:**
```bash
# ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ç¢ºèª
docker compose exec dify-api flask db current

# ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã‚’ç¢ºèª
docker compose exec dify-api flask db history
```

**ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒé…ã„å ´åˆ:**
```bash
# 1. ã‚³ãƒ³ãƒ†ãƒŠãŒå®Œå…¨ã«èµ·å‹•ã™ã‚‹ã¾ã§å¾…ã¤ï¼ˆ30ç§’ç¨‹åº¦ï¼‰
docker compose ps

# 2. APIãƒ­ã‚°ã‚’ç¢ºèª
docker compose logs dify-api --tail=20

# 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šç¢ºèª
docker compose exec db psql -U dify -d dify -c "SELECT 1;"
```

### 8.9 ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—æ™‚ã®å®‰å…¨ãªæ‰‹é †

```bash
# 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆå¿…é ˆï¼‰
docker compose exec db pg_dump -U dify dify > backup_$(date +%Y%m%d).sql

# 2. ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›´
# docker-compose.yml ã® 0.11.1 â†’ 0.11.2

# 3. ã‚³ãƒ³ãƒ†ãƒŠå†ä½œæˆ
docker compose down
docker compose pull
docker compose up -d

# 4. ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
docker compose exec dify-api flask db upgrade

# 5. å‹•ä½œç¢ºèª
curl http://localhost:8080/console/api/setup
docker compose logs dify-api --tail=50
```

**æ³¨æ„ç‚¹:**
- ãƒžã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã§ã‚‚ç ´å£Šçš„å¤‰æ›´ãŒã‚ã‚‹å¯èƒ½æ€§
- å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‹
- å¯èƒ½ãªã‚‰ãƒ†ã‚¹ãƒˆç’°å¢ƒã§å…ˆã«è©¦ã™

### 8.10 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

#### æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšå®Ÿæ–½

```bash
# 1. å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
POSTGRES_PASSWORD=$(openssl rand -base64 32)
SECRET_KEY=$(openssl rand -base64 32)

# 2. .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’Gitç®¡ç†ã‹ã‚‰é™¤å¤–
echo ".env" >> .gitignore

# 3. .envãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³åˆ¶é™
chmod 600 .env

# 4. ä¸è¦ãªãƒãƒ¼ãƒˆã‚’é–‰ã˜ã‚‹
# docker-compose.ymlã§ãƒãƒ¼ãƒˆå…¬é–‹ã‚’æœ€å°é™ã«
```

#### APIã‚­ãƒ¼ç®¡ç†
```bash
# OpenAI APIã‚­ãƒ¼ã¯å¿…ãš.envã«ä¿å­˜
# docker-compose.ymlã«ç›´æŽ¥æ›¸ã‹ãªã„
OPENAI_API_KEY=sk-xxx...
```

### 8.11 ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ»ãƒ‡ãƒãƒƒã‚°

#### ãƒ­ã‚°ç¢ºèª
```bash
# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã¿è¡¨ç¤º
docker compose logs dify-api --since 1h | grep -i error

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç›£è¦–
docker compose logs -f dify-api dify-worker

# ç‰¹å®šæ™‚é–“ç¯„å›²ã®ãƒ­ã‚°
docker compose logs dify-api --since 2025-01-01T00:00:00 --until 2025-01-01T23:59:59
```

#### ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–
```bash
# ã‚³ãƒ³ãƒ†ãƒŠã®ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
docker stats

# ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡
docker system df
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šãƒ†ã‚¹ãƒˆ
```bash
# PythonçµŒç”±ã§DBæŽ¥ç¶šç¢ºèª
docker compose exec dify-api python -c "from extensions.ext_database import db; print(db.engine.url)"

# psqlçµŒç”±ã§DBæŽ¥ç¶šç¢ºèª
docker compose exec db psql -U dify -d dify -c "SELECT COUNT(*) FROM accounts;"
```

### 8.12 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
docker compose exec db pg_dump -U dify dify > backup.sql

# ãƒªã‚¹ãƒˆã‚¢
cat backup.sql | docker compose exec -T db psql -U dify -d dify
```

#### ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
```bash
# PostgreSQLãƒ‡ãƒ¼ã‚¿
docker run --rm -v dify_vectordb_autoprograming_pg-data:/data -v $(pwd):/backup alpine tar czf /backup/pg-data-backup.tar.gz /data

# ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿
docker run --rm -v dify_vectordb_autoprograming_storage-data:/data -v $(pwd):/backup alpine tar czf /backup/storage-backup.tar.gz /data
```

### 8.13 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### å•é¡Œ: 500 Internal Server Error
```bash
# 1. ãƒ­ã‚°ç¢ºèª
docker compose logs dify-api --tail=50

# 2. ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
docker compose exec dify-api flask db upgrade

# 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šç¢ºèª
docker compose exec dify-api python -c "import psycopg2; conn = psycopg2.connect('postgresql://dify:changeme@db:5432/dify'); print('OK')"

# 4. ç’°å¢ƒå¤‰æ•°ç¢ºèª
docker compose exec dify-api env | grep -E "(DATABASE|POSTGRES|REDIS)"
```

#### å•é¡Œ: Embeddingå‡¦ç†ãŒé€²ã¾ãªã„
```bash
# 1. Workerèµ·å‹•ç¢ºèª
docker compose ps dify-worker

# 2. Workerãƒ­ã‚°ç¢ºèª
docker compose logs dify-worker --tail=50

# 3. Celeryã‚­ãƒ¥ãƒ¼ç¢ºèª
docker compose exec dify-api python -c "from celery import Celery; app = Celery(broker='redis://redis:6379/1'); print(app.control.inspect().active())"
```

#### å•é¡Œ: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Failed to request plugin daemon, url: plugin/[UUID]/management/models
Failed to request plugin daemon, url: plugin/[UUID]/management/install/tasks
```

**åŽŸå› :**
1. Dify 0.12.xä»¥é™ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
2. `plugin-daemon`ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ã¦ã„ãªã„ï¼ˆdocker-compose.ymlã«å­˜åœ¨ã—ãªã„ï¼‰
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–¢é€£æƒ…å ±ãŒæ®‹ã£ã¦ã„ã‚‹

**è§£æ±ºç­–1: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ˆæŽ¨å¥¨ãƒ»æœ€ã‚‚ç°¡å˜ï¼‰**
```yaml
# docker-compose.yml ã‚’ä»¥ä¸‹ã«å¤‰æ›´
services:
  dify-web:
    image: docker.io/langgenius/dify-web:0.11.1  # latest â†’ 0.11.1

  dify-api:
    image: docker.io/langgenius/dify-api:0.11.1  # latest â†’ 0.11.1
    environment:
      - PLUGIN_ENABLED=false
      - DISABLE_PLUGIN_MANAGER=true
      # ... ãã®ä»–ã®ç’°å¢ƒå¤‰æ•°

  dify-worker:
    image: docker.io/langgenius/dify-api:0.11.1  # latest â†’ 0.11.1
    environment:
      - PLUGIN_ENABLED=false
      - DISABLE_PLUGIN_MANAGER=true
      # ... ãã®ä»–ã®ç’°å¢ƒå¤‰æ•°
```

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†ä½œæˆ
docker compose down
docker compose pull
docker compose up -d
```

**è§£æ±ºç­–2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒ‡ãƒ¼ã‚¿ä¿æŒã—ãŸã„å ´åˆï¼‰**
```bash
# 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆå¿…é ˆï¼‰
docker compose exec db pg_dump -U dify dify > backup_$(date +%Y%m%d).sql

# 2. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¯ãƒªã‚¢
docker compose exec db psql -U dify -d dify << EOF
TRUNCATE TABLE account_plugin_permissions CASCADE;
TRUNCATE TABLE tenant_plugin_auto_upgrade_strategies CASCADE;
TRUNCATE TABLE pipeline_recommended_plugins CASCADE;
DELETE FROM installed_apps WHERE app_id LIKE '%plugin%';
EOF

# 3. ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•
docker compose restart dify-api dify-worker
```

**è§£æ±ºç­–3: å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿å‰Šé™¤OKï¼‰**
```bash
# ã™ã¹ã¦åœæ­¢
docker compose down

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒœãƒªãƒ¥ãƒ¼ãƒ å‰Šé™¤
docker volume rm dify_vectordb_autoprograming_pg-data

# å†èµ·å‹•
docker compose up -d

# ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
docker compose exec dify-api flask db upgrade
```

**ãªãœ0.11.1ã‚’ä½¿ã†ã®ã‹ï¼Ÿ**
- âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒãªã„ãŸã‚å®‰å®š
- âœ… åŸºæœ¬æ©Ÿèƒ½ã¯ååˆ†ã«ä½¿ãˆã‚‹
- âœ… ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„
- âŒ 0.12.xä»¥é™: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½è¿½åŠ ã€`plugin-daemon`ã‚µãƒ¼ãƒ“ã‚¹ãŒå¿…è¦ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸è¶³ã€ä¸å®‰å®š

## 12. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆä¿å­˜ç‰ˆï¼‰

### åˆå›žã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚
- [ ] ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å›ºå®šï¼ˆ0.11.1ãªã©ã€latestç¦æ­¢ï¼‰
- [ ] ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç„¡åŠ¹åŒ–ï¼ˆ`PLUGIN_ENABLED=false`ï¼‰
- [ ] DBè¨­å®š3ç¨®é¡žã™ã¹ã¦è¨­å®šï¼ˆ`DATABASE_URL`, `SQLALCHEMY_DATABASE_URI`, å€‹åˆ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
- [ ] Redisè¨­å®šã‚’æ˜Žç¤ºçš„ã«è¨­å®šï¼ˆ`REDIS_HOST=redis`ï¼‰
- [ ] ãƒ™ã‚¯ãƒˆãƒ«DBè¨­å®šï¼ˆ`VECTOR_STORE=pgvector`ï¼‰
- [ ] Worker commandæ˜Žç¤ºçš„ã«è¨­å®šï¼ˆentrypointç„¡åŠ¹åŒ–ï¼‰
- [ ] `.env`ã¨`docker-compose.yml`ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸€è‡´ç¢ºèª
- [ ] åˆå›žãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆ`flask db upgrade`ï¼‰
- [ ] `.env`ã‚’`.gitignore`ã«è¿½åŠ 
- [ ] å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

### ãƒˆãƒ©ãƒ–ãƒ«ç™ºç”Ÿæ™‚
- [ ] ã‚³ãƒ³ãƒ†ãƒŠçŠ¶æ…‹ç¢ºèªï¼ˆ`docker compose ps`ï¼‰
- [ ] ãƒ­ã‚°ç¢ºèªï¼ˆ`docker compose logs [service] --tail=50`ï¼‰
- [ ] ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆ`flask db upgrade`ï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šç¢ºèª
- [ ] ç’°å¢ƒå¤‰æ•°ç¢ºèªï¼ˆ`docker compose exec dify-api env`ï¼‰
- [ ] ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•ï¼ˆ`docker compose restart`ï¼‰
- [ ] å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆæœ€çµ‚æ‰‹æ®µ: `docker compose down -v`ï¼‰

## 12. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆAWS ã§å…¬é–‹é‹ç”¨ï¼‰

ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ä½“é¨“å¾Œã¯ã€AWSï¼ˆECS Fargate + RDS pgvector + ElastiCache + ALB + HTTPSï¼‰ã¸å±•é–‹ã—ã¦å…¬é–‹é‹ç”¨ãŒå¯èƒ½ã§ã™ã€‚è¬›åº§ã®å¾ŒåŠã§ã€ä»¥ä¸‹ã‚’æ‰±ã„ã¾ã™ã€‚
- ã‚³ãƒ³ãƒ†ãƒŠã®ECRãƒŸãƒ©ãƒ¼ã€ã‚¿ã‚¹ã‚¯å®šç¾©ï¼ˆapi/web/workerï¼‰
- ALBã§ã®ãƒ›ã‚¹ãƒˆ/ãƒ‘ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨HTTPSï¼ˆACMï¼‰
- Secrets/SSM/KMSã€NATãƒ¬ã‚¹é‹ç”¨ï¼ˆVPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- ç›£è¦–ãƒ»ãƒ­ã‚°ï¼ˆCloudWatch Logsï¼‰ã€ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ˜ãƒ«ã‚¹/ãƒ«ãƒ¼ãƒ«ï¼‰

è©³ç´°æ‰‹é †ã¯ `AWS_DEPLOY_BEDROCK.md` ã‚’å‚ç…§ï¼ˆBedrock Titan v2 Embeddings + Claude 2ã€NATãƒ¬ã‚¹é‹ç”¨ï¼‰ã€‚

## 12. Cursor ã‚’ä½¿ã£ã¦ã€ŒãŽã‚ƒã‚‹ã§ã‚Œã‚‰ã€ã‚’ä½œã‚‹

ä»¥ä¸‹ã®æŒ‡ç¤ºæ›¸ã‚’ Cursor ã«èª­ã¿è¾¼ã¾ã›ã¦ã€çŸ­æ™‚é–“ã§ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼AIã‚’ä½œã‚Œã¾ã™ã€‚
- `cursor/INSTRUCTIONS_GYARU_CINDERELLA.md`
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ã‚µãƒ³ãƒ—ãƒ«: `samples/gyaru_cinderella_profile.md`

## 12. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè‡ªä½“ã¯ MIT ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¤‰æ›´å¯ï¼‰ã€‚Difyæœ¬ä½“ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯å…¬å¼ã«å¾“ã„ã¾ã™ã€‚
