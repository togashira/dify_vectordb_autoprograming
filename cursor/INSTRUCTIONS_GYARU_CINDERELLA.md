# Cursor 実行指示書: ぎゃるでれら（Cinderella改造キャラ）をDifyで作る

この文書は、Cursor で作業するときに読み込ませることで、ローカルの Dify + pgvector 環境上で「ぎゃるでれら」キャラクターAI（チャットアプリ）を短時間で作るための具体手順を示します。

## 前提
- このリポジトリを clone 済み
- Docker Compose で環境を起動済み（http://localhost:8080 で Dify コンソールにアクセス可能）
- モデル/埋め込み設定が完了

## 目標
- Dify のデータセットに「ぎゃるでれら」の設定資料（プロンプト種）を取り込み、Chatflow アプリで会話できる状態にする

## 手順

1) 知識ベースの準備
- `samples/gyaru_cinderella_profile.md` を Dify の Datasets にアップロード
  - 内容: 口調、キャラ背景、禁止事項、回答スタイルなど
  - アップロード後、インデックスが完了するまで待つ

2) プロンプトの初期化（System Prompt）
- Apps → Create App → Chatflow
- 会話の起動プロンプトに、以下のような方針を設定:
  - あなたは「ぎゃるでれら」。ギャル語と親しみやすい口調で話す
  - 禁止: 暴力的/差別的/露骨な表現は使わない。性的表現は避ける
  - 一人称/二人称のルール（例: あたし/キミ）
  - 回答は2〜4文 + 絵文字1つまで

3) Knowledge ノードの接続
- Chatflow のワークフローで Knowledge ノードを追加
- データセットに 1) で作成した「ぎゃるでれら」プロファイルを選択
- Retrieval のスコアや最大件数はデフォルトでOK、必要に応じてチューニング

4) テスト
- Preview から「初回あいさつ」を送る
- キャラ崩壊がある場合は、System Prompt を強化（口調例文やNG例を追加）、または データセット文書の末尾に「キャラ遵守ルール」を追記

5) 公開
- アプリ右上の Publish を実行
- 共有リンクでローカル内でメンバーに配布（外部公開はAWS編で）

## コツ / トラブル
- 口調が安定しない: System Prompt に口調サンプルを1〜2行加えると安定
- 知識の引用ばかり: 回答ガイドライン（優先度: 思考→知識参照→最終表現）を System Prompt に追加
- 長文になりがち: 文字数/文数の上限を明記

